# This is a basic workflow to help you get started with Actions

name: Create Booklet from Canva

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

env:
  H_SOURCE_PDF: booklet_no_bleed.pdf
  H_TARGET_PDF: booklet_home_print.pdf
  P_SOURCE_PDF: booklet_with_bleed.pdf
  P_TARGET_PDF: booklet_professional_print.pdf
  OUT_PATH: out

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v4

      - name: üèóÔ∏è Install pdf tools
        uses: daaku/gh-action-apt-install@v4
        with:
          packages: mupdf-tools texlive-extra-utils texlive-latex-recommended texlive-latex-base

      - name: üß∞ Reconfigure packages
        run: sudo apt install -y texlive-latex-recommended

      - name: üëü Create home print booklet
        run: |
          mkdir -p $OUT_PATH
          ./canva_to_home_print.sh "$H_SOURCE_PDF" "$OUT_PATH/$H_TARGET_PDF"

      - name: üëü Create professional print booklet
        run: |
          ./canva_to_professional_print.sh "$P_SOURCE_PDF" "$OUT_PATH/$P_TARGET_PDF"

      - name: üñ¥ Store final Booklet
        uses: actions/upload-artifact@v4
        with:
          name: booklet-pdfs
          path: ${{ env.OUT_PATH }}

      - name: üéâ Push to stable branch
        uses: s0/git-publish-subdir-action@develop
        env:
          REPO: self
          BRANCH: release
          FOLDER: ${{ env.OUT_PATH }}
          # https://github.com/ad-m/github-push-action/issues/96
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # GitHub will automatically add this - you don't need to bother getting a token
          MESSAGE: "Build: ({sha}) {msg}" # The commit message
